<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="UTF-8">
    <title>Motorcycles</title>
    <th:block th:replace="~{fragments/bootstrap :: bootstrap-link}"></th:block>
    <th:block th:replace="~{fragments/font :: font-link}"></th:block>
    <link th:href="@{/style/main.css}" rel="stylesheet"/>
    <link th:href="@{/style/stars-rating-read.css}" rel="stylesheet"/>
</head>

<body>

<div th:replace="~{fragments/navbar/header :: content}"></div>

<div class="container my-4">

    <div class="d-flex justify-content-end">
        <form th:method="GET" th:action="@{/motorcycles}" class="d-flex justify-content-end">
            <select class="form-select" name="sort">
                <option th:value="${null}">--Sort type--</option>
                <option value="brand.name:asc, model:asc" th:selected="${currentSort == 'brand.name:asc, model:asc'}">A→Z</option>
                <option value="brand.name:desc, model:desc" th:selected="${currentSort == 'brand.name:desc, model:desc'}">Z→A</option>
            </select>

            <input type="hidden" name="pageNumber" th:value="${currentPageNumber}">

            <button type="submit" class="btn btn-dark ms-1">Sort</button>
        </form>
    </div>

    <div class="row">
        <div class="col-sm-12 col-md-4 col-lg-3 d-flex align-items-center flex-column p-2"
             th:each="motorcycle: ${motorcyclePage.content}">

            <a class="d-flex flex-column align-items-center border border-black rounded text-decoration-none text-black p-3"
               th:href="@{/motorcycles/{id}(id=${motorcycle.getId()})}">

                <img th:src="@{/img/motorcycle.png}" class="img-thumbnail border-0 mb-1" alt="Motorcycle" draggable="false">
                <h4 th:text="${motorcycle.getBrand().getName() + ' ' + motorcycle.getModel()}"
                      class="text-center mb-1"></h4>

                <div class="d-flex justify-content-between w-100">

                    <div th:with="avgRating=${motorcycleIdToAvgRating.get(motorcycle.id)}"
                         class="d-flex justify-content-start align-items-center">

                        <small th:text="${avgRating != null ? #numbers.formatDecimal(avgRating, 1, 1) : '0.0'}"
                               class="text-muted me-1"></small>

                        <meter class="average-rating d-flex align-items-center" min="0" max="5" th:value="${avgRating}"></meter>

                    </div>

                    <small class="text-muted">
                        <span th:text="${motorcycle.getReviews().size()}"></span> review<span
                            th:if="${motorcycle.getReviews().size() != 1}">s</span>
                    </small>

                </div>

            </a>

        </div>
    </div>

    <nav class="d-flex justify-content-center mt-2">
        <ul th:if="${motorcyclePage.totalPages > 0}" class="pagination">

            <th:block th:with="hasPrevious=${motorcyclePage.hasPrevious()}">

                <li th:class="${hasPrevious} ? 'page-item': 'page-item disabled'">
                    <a th:href="@{/motorcycles(pageNumber=0, sort=${currentSort})}" class="page-link">❮❮</a>
                </li>

                <li th:class="${hasPrevious} ? 'page-item': 'page-item disabled'">
                    <a th:href="@{/motorcycles(pageNumber=${currentPageNumber - 1}, sort=${currentSort})}" class="page-link">❮</a>
                </li>

            </th:block>

            <th:block th:with="startPage=${(currentPageNumber > 5) ? (currentPageNumber - 5) : 0}, endPage=${(startPage + 10 > motorcyclePage.totalPages - 1) ? motorcyclePage.totalPages - 1 : (startPage + 10)}">
                <li th:if="${startPage > 0}" class="page-item disabled">
                    <a class="page-link">...</a>
                </li>
                <li th:each="pageNumber : ${#numbers.sequence(startPage, endPage)}" th:class="${pageNumber == currentPageNumber} ? 'active page-item' : 'page-item'">
                    <a th:href="@{/motorcycles(pageNumber=${pageNumber}, sort=${currentSort})}" th:text="${pageNumber + 1}" class="page-link"></a>
                </li>
                <li th:if="${endPage < motorcyclePage.totalPages - 1}" class="page-item disabled">
                    <a class="page-link">...</a>
                </li>
            </th:block>

            <th:block th:with="hasNext=${motorcyclePage.hasNext()}">

            <li th:class="${hasNext} ? 'page-item': 'page-item disabled'">
                <a th:href="@{/motorcycles(pageNumber=${currentPageNumber + 1}, sort=${currentSort})}" class="page-link">❯</a>
            </li>

            <li th:class="${hasNext} ? 'page-item': 'page-item disabled'">
                <a th:href="@{/motorcycles(pageNumber=${motorcyclePage.totalPages - 1}, sort=${currentSort})}" class="page-link">❯❯</a>
            </li>

            </th:block>

        </ul>
    </nav>

</div>

<script th:src="@{/script/stars-rating-read.js}"></script>
</body>
</html>